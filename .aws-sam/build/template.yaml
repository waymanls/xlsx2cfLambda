AWSTemplateFormatVersion: '2010-09-09'
Transform: AWS::Serverless-2016-10-31
Description: 'xlsx2cfLambda

  Sample SAM Template for xlsx2cfLambda

  '
Globals:
  Function:
    Timeout: 300
Resources:
  Bucket:
    Type: AWS::S3::Bucket
    Properties:
      BucketName: xlsx2cfDemoBucket
  xlsx2cfFunction:
    Type: AWS::Serverless::Function
    Properties:
      CodeUri: xlsx2cfFunction
      Description: Lambda function to generate CloudFormation temlate and Stack from
        Excel Spreadsheet
      Handler: app.lambda_handler
      Runtime: python3.9
      Policies:
      - Statement:
        - Sid: xlsx2cfS3Policy
          Effect: Allow
          Action:
          - s3:GetObject
          Resource: arn:aws:s3:::xlsx2cfDemoBucket/*
        - Sid: xlsx2cfCreateLogGroupPolicy
          Effect: Allow
          Action:
          - logs:CreateLogGroup
          Resource:
            Fn::Sub: arn:aws:logs:${AWS::Region}:${AWS::AccountId}:*
        - Sid: xlsx2cfCreateLogStreamPolicy
          Effect: Allow
          Action:
          - logs:CreateLogStream
          - logs:PutLogEvents
          Resource:
            Fn::Sub: arn:aws:logs:${AWS::Region}:${AWS::AccountId}:log-group:/aws/lambda/*
        - Sid: xlsx2cfCloudFormationPolicy
          Effect: Allow
          Action:
          - cloudformation:*
          Resource: '*'
        - Sid: xlsx2cfEC2RDSPolicy
          Effect: Allow
          Action:
          - ec2:*
          - rds:*
          Resource: '*'
      Events:
        ObjectPutEvent:
          Type: S3
          Properties:
            Bucket:
              Ref: Bucket
            Events: s3:ObjectCreated:*
Outputs:
  xlsx2cfFunction:
    Description: xlsx2cf Lambda Function ARN
    Value:
      Fn::GetAtt:
      - xlsx2cfFunction
      - Arn
  xlsx2cfIamRole:
    Description: Implicit IAM Role created for Hello World function
    Value:
      Fn::GetAtt:
      - xlsx2cfFunctionRole
      - Arn
